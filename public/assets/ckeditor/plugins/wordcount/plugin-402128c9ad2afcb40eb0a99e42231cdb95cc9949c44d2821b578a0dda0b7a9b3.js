CKEDITOR.plugins.add("wordcount",{lang:"ar,ca,da,de,el,en,es,eu,fa,fi,fr,he,hr,it,jp,nl,no,pl,pt,pt-br,ru,sk,sv,tr,zh-cn",version:1.15,requires:"htmlwriter,notification,undo",bbcodePluginLoaded:!1,onLoad:function(){CKEDITOR.document.appendStyleSheet(this.path+"css/wordcount.css")},init:function(n){function t(n){return"cke_wordcount_"+n.name}function e(n){return document.getElementById(t(n))}function a(n){if(bbcodePluginLoaded)return n.replace(/\[.*?\]/gi,"");var t=document.createElement("div");return n=o(n),t.innerHTML=n,""==t.textContent&&"undefined"==typeof t.innerText?"":t.textContent||t.innerText}function o(n){if(L.filter instanceof CKEDITOR.htmlParser.filter){var t=CKEDITOR.htmlParser.fragment.fromHtml(n),e=new CKEDITOR.htmlParser.basicWriter;return L.filter.applyTo(t),t.writeHtml(e),e.getHtml()}return n}function r(t){if(L.countHTML)return o(t).length;var e;if(n.config.fullPage){var r=t.search(new RegExp("<body>","i"));if(r!=-1){var u=t.search(new RegExp("</body>","i"));t=t.substring(r+6,u)}}return e=t,L.countSpacesAsChars||(e=t.replace(/\s/g,"").replace(/&nbsp;/g,"")),e=e.replace(/(\r\n|\n|\r)/gm,"").replace(/&nbsp;/gi," "),e=a(e).replace(/^([\t\r\n]*)$/,""),e.length}function u(n){return n.replace(/&nbsp;/g," ").replace(/(<([^>]+)>)/gi,"").replace(/^\s*$[\n\r]{1,}/gm,"++").split("++").length}function c(n){var t=n.replace(/(\r\n|\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," ");t=a(t);for(var e=t.split(/\s+/),o=e.length-1;o>=0;o--)e[o].match(/^([\s\t\r\n]*)$/)&&e.splice(o,1);return e.length}function i(t,a){p=!0,m=!1,L.hardLimit&&(t.loadSnapshot(f),t.config.Locked=1),a||(e(t).className="cke_path_item cke_wordcountLimitReached",t.fire("limitReached",{},n))}function h(t){m=!0,p=!1,t.config.Locked=0,f=n.getSnapshot(),e(t).className="cke_path_item"}function s(n){var t,a=0,o=0,s=0;(t=n.getData())&&(L.showCharCount&&(s=r(t,n)),L.showParagraphs&&(a=u(t)),L.showWordCount&&(o=c(t)));var d=T.replace("%wordCount%",o).replace("%charCount%",s).replace("%paragraphs%",a);if((n.config.wordcount||(n.config.wordcount={})).wordCount=o,(n.config.wordcount||(n.config.wordcount={})).charCount=s,CKEDITOR.env.gecko?e(n).innerHTML=d:e(n).innerText=d,s==g&&o==C)return!0;var l=o-C,m=s-g;return C=o,g=s,C==-1&&(C=o),g==-1&&(g=s),L.maxWordCount>-1&&o>L.maxWordCount&&l>0||L.maxCharCount>-1&&s>L.maxCharCount&&m>0?i(n,p):(L.maxWordCount==-1||o<L.maxWordCount)&&(L.maxCharCount==-1||s<L.maxCharCount)?h(n):f=n.getSnapshot(),L.charCountGreaterThanMaxLengthEvent&&L.charCountLessThanMaxLengthEvent&&(s>L.maxCharCount&&L.maxCharCount>-1?L.charCountGreaterThanMaxLengthEvent(s,L.maxCharCount):L.charCountLessThanMaxLengthEvent(s,L.maxCharCount)),L.wordCountGreaterThanMaxLengthEvent&&L.wordCountLessThanMaxLengthEvent&&(o>L.maxWordCount&&L.maxWordCount>-1?L.wordCountGreaterThanMaxLengthEvent(o,L.maxWordCount):L.wordCountLessThanMaxLengthEvent(o,L.maxWordCount)),!0}var d,l="",C=-1,g=-1,p=!1,m=!1,f=n.getSnapshot(),w=null,x=function(n,t,e){if("undefined"!=typeof document.dispatchEvent){n="ckeditor.wordcount."+n;var a,o={bubbles:!1,cancelable:!0,detail:{currentLength:t,maxLength:e}};try{a=new CustomEvent(n,o)}catch(t){a=document.createEvent("CustomEvent"),a.initCustomEvent(n,o.bubbles,o.cancelable,o.detail)}document.dispatchEvent(a)}},v={showParagraphs:!0,showWordCount:!0,showCharCount:!1,countSpacesAsChars:!1,countHTML:!1,hardLimit:!0,maxWordCount:-1,maxCharCount:-1,filter:null,wordCountGreaterThanMaxLengthEvent:function(n,t){x("wordCountGreaterThanMaxLengthEvent",n,t)},charCountGreaterThanMaxLengthEvent:function(n,t){x("charCountGreaterThanMaxLengthEvent",n,t)},wordCountLessThanMaxLengthEvent:function(n,t){x("wordCountLessThanMaxLengthEvent",n,t)},charCountLessThanMaxLengthEvent:function(n,t){x("charCountLessThanMaxLengthEvent",n,t)}},L=CKEDITOR.tools.extend(v,n.config.wordcount||{},!0);if(L.showParagraphs&&(l+=n.lang.wordcount.Paragraphs+" %paragraphs%"),L.showParagraphs&&(L.showWordCount||L.showCharCount)&&(l+=", "),L.showWordCount&&(l+=n.lang.wordcount.WordCount+" %wordCount%",L.maxWordCount>-1&&(l+="/"+L.maxWordCount)),L.showCharCount&&L.showWordCount&&(l+=", "),L.showCharCount){var E=n.lang.wordcount[L.countHTML?"CharCountWithHTML":"CharCount"];l+=E+" %charCount%",L.maxCharCount>-1&&(l+="/"+L.maxCharCount)}var T=l;bbcodePluginLoaded="undefined"!=typeof n.plugins.bbcode,n.on("key",function(t){"source"===n.mode&&s(t.editor)},n,null,100),n.on("change",function(n){s(n.editor)},n,null,100),n.on("uiSpace",function(e){n.elementMode===CKEDITOR.ELEMENT_MODE_INLINE?"top"==e.data.space&&(e.data.html+='<div class="cke_wordcount" style="" title="'+n.lang.wordcount.title+'"><span id="'+t(e.editor)+'" class="cke_path_item">&nbsp;</span></div>'):"bottom"==e.data.space&&(e.data.html+='<div class="cke_wordcount" style="" title="'+n.lang.wordcount.title+'"><span id="'+t(e.editor)+'" class="cke_path_item">&nbsp;</span></div>')},n,null,100),n.on("dataReady",function(n){s(n.editor)},n,null,100),n.on("paste",function(n){if(L.maxWordCount>0||L.maxCharCount>0){var t=-1,e=-1,a=n.editor.getData()+n.data.dataValue;L.showCharCount&&(e=r(a,n.editor)),L.showWordCount&&(t=c(a)),null===w&&(w=new CKEDITOR.plugins.notification(n.editor,{message:n.editor.lang.wordcount.pasteWarning,type:"warning"})),L.maxCharCount>0&&e>L.maxCharCount&&L.hardLimit&&(w.isVisible()||w.show(),n.cancel()),L.maxWordCount>0&&t>L.maxWordCount&&L.hardLimit&&(w.isVisible()||w.show(),n.cancel())}},n,null,100),n.on("afterPaste",function(n){s(n.editor)},n,null,100),n.on("blur",function(){d&&window.clearInterval(d)},n,null,300)}});